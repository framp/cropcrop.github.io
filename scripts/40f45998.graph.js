!function($){var trace=function(msg){if("undefined"!=typeof window&&window.console){for(var len=arguments.length,args=[],i=0;len>i;i++)args.push("arguments["+i+"]");eval("console.log("+args.join(",")+")")}},dirname=function(a){var b=a.replace(/^\/?(.*?)\/?$/,"$1").split("/");return b.pop(),"/"+b.join("/")},basename=function(a){var b=a.replace(/^\/?(.*?)\/?$/,"$1").split("/"),c=b.pop();return""==c?null:c},_ordinalize_re=/(\d)(?=(\d\d\d)+(?!\d))/g,ordinalize=function(a){var b=""+a;return 11e3>a?b=(""+a).replace(_ordinalize_re,"$1,"):1e6>a?b=Math.floor(a/1e3)+"k":1e9>a&&(b=(""+Math.floor(a/1e3)).replace(_ordinalize_re,"$1,")+"m"),b},nano=function(a,b){return a.replace(/\{([\w\-\.]*)}/g,function(a,c){var d=c.split("."),e=b[d.shift()];return $.each(d,function(){e=e.hasOwnProperty(this)?e[this]:a}),e})},objcopy=function(a){if(void 0===a)return void 0;if(null===a)return null;if(a.parentNode)return a;switch(typeof a){case"string":return a.substring(0);case"number":return a+0;case"boolean":return a===!0}var b=$.isArray(a)?[]:{};return $.each(a,function(a,c){b[a]=objcopy(c)}),b},objmerge=function(a,b){a=a||{},b=b||{};var c=objcopy(a);for(var d in b)c[d]=b[d];return c},objcmp=function(a,b,c){if(!a||!b)return a===b;if(typeof a!=typeof b)return!1;if("object"!=typeof a)return a===b;if($.isArray(a)){if(!$.isArray(b))return!1;if(a.length!=b.length)return!1}else{var d=[];for(var e in a)a.hasOwnProperty(e)&&d.push(e);var f=[];for(var e in b)b.hasOwnProperty(e)&&f.push(e);if(c||(d.sort(),f.sort()),d.join(",")!==f.join(","))return!1}var g=!0;return $.each(a,function(c){var d=objcmp(a[c],b[c]);return g=g&&d,g?void 0:!1}),g},objkeys=function(a){var b=[];return $.each(a,function(c){a.hasOwnProperty(c)&&b.push(c)}),b},objcontains=function(a){if(!a||"object"!=typeof a)return!1;for(var b=1,c=arguments.length;c>b;b++)if(a.hasOwnProperty(arguments[b]))return!0;return!1},uniq=function(a){for(var b=a.length,c={},d=0;b>d;d++)c[a[d]]=!0;return objkeys(c)},arbor_path=function(){var a=$("script").map(function(){var a=$(this).attr("src");if(a)return a.match(/arbor[^\/\.]*.js|dev.js/)?a.match(/.*\//)||"/":void 0});return a.length>0?a[0]:null},Kernel=function(a){var b="file:"==window.location.protocol&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1,c=void 0!==window.Worker&&!b,d=null,e=null,f=[];f.last=new Date;var g=null,h=null,i=null,j=null,k=!1,l={system:a,tween:null,nodes:{},init:function(){e="undefined"!=typeof Tween?Tween():"undefined"!=typeof arbor.Tween?arbor.Tween():{busy:function(){return!1},tick:function(){return!0},to:function(){trace("Please include arbor-tween.js to enable tweens"),e.to=function(){}}},l.tween=e;var b=a.parameters();return c?(trace("arbor.js/web-workers",b),g=setInterval(l.screenUpdate,b.timeout),d=new Worker(arbor_path()+"arbor.js"),d.onmessage=l.workerMsg,d.onerror=function(a){trace("physics:",a)},d.postMessage({type:"physics",physics:objmerge(b,{timeout:Math.ceil(b.timeout)})})):(trace("arbor.js/single-threaded",b),d=Physics(b.dt,b.stiffness,b.repulsion,b.friction,l.system._updateGeometry,b.integrator),l.start()),l},graphChanged:function(a){c?d.postMessage({type:"changes",changes:a}):d._update(a),l.start()},particleModified:function(a,b){c?d.postMessage({type:"modify",id:a,mods:b}):d.modifyNode(a,b),l.start()},physicsModified:function(a){isNaN(a.timeout)||(c?(clearInterval(g),g=setInterval(l.screenUpdate,a.timeout)):(clearInterval(i),i=null)),c?d.postMessage({type:"sys",param:a}):d.modifyPhysics(a),l.start()},workerMsg:function(a){var b=a.data.type;"geometry"==b?l.workerUpdate(a.data):trace("physics:",a.data)},_lastPositions:null,workerUpdate:function(a){l._lastPositions=a,l._lastBounds=a.bounds},_lastFrametime:(new Date).valueOf(),_lastBounds:null,_currentRenderer:null,screenUpdate:function(){var a=((new Date).valueOf(),!1);if(null!==l._lastPositions&&(l.system._updateGeometry(l._lastPositions),l._lastPositions=null,a=!0),e&&e.busy()&&(a=!0),l.system._updateBounds(l._lastBounds)&&(a=!0),a){var b=l.system.renderer;if(void 0!==b){b!==h&&(b.init(l.system),h=b),e&&e.tick(),b.redraw();var c=f.last;f.last=new Date,f.push(f.last-c),f.length>50&&f.shift()}}},physicsUpdate:function(){e&&e.tick(),d.tick();var a=l.system._updateBounds();e&&e.busy()&&(a=!0);var b=l.system.renderer,c=new Date,b=l.system.renderer;void 0!==b&&(b!==h&&(b.init(l.system),h=b),b.redraw({timestamp:c}));var g=f.last;f.last=c,f.push(f.last-g),f.length>50&&f.shift();var k=d.systemEnergy();(k.mean+k.max)/2<.05?(null===j&&(j=(new Date).valueOf()),(new Date).valueOf()-j>1e3&&(clearInterval(i),i=null)):j=null},fps:function(a){if(void 0!==a){var b=1e3/Math.max(1,targetFps);l.physicsModified({timeout:b})}for(var c=0,d=0,e=f.length;e>d;d++)c+=f[d];var g=c/Math.max(1,f.length);return isNaN(g)?0:Math.round(1e3/g)},start:function(a){null===i&&(!k||a)&&(k=!1,c?d.postMessage({type:"start"}):(j=null,i=setInterval(l.physicsUpdate,l.system.parameters().timeout)))},stop:function(){k=!0,c?d.postMessage({type:"stop"}):null!==i&&(clearInterval(i),i=null)}};return l.init()},Node=function(a){this._id=_nextNodeId++,this.data=a||{},this._mass=void 0!==a.mass?a.mass:1,this._fixed=a.fixed===!0?!0:!1,this._p=new Point("number"==typeof a.x?a.x:null,"number"==typeof a.y?a.y:null),delete this.data.x,delete this.data.y,delete this.data.mass,delete this.data.fixed},_nextNodeId=1,Edge=function(a,b,c){this._id=_nextEdgeId--,this.source=a,this.target=b,this.length=void 0!==c.length?c.length:1,this.data=void 0!==c?c:{},delete this.data.length},_nextEdgeId=-1,Particle=function(a,b){this.p=a,this.m=b,this.v=new Point(0,0),this.f=new Point(0,0)};Particle.prototype.applyForce=function(a){this.f=this.f.add(a.divide(this.m))};var Spring=function(a,b,c,d){this.point1=a,this.point2=b,this.length=c,this.k=d};Spring.prototype.distanceToParticle=function(a){var b=that.point2.p.subtract(that.point1.p).normalize().normal(),c=a.p.subtract(that.point1.p);return Math.abs(c.x*b.x+c.y*b.y)};var Point=function(a,b){a&&a.hasOwnProperty("y")&&(b=a.y,a=a.x),this.x=a,this.y=b};Point.random=function(a){return a=void 0!==a?a:5,new Point(2*a*(Math.random()-.5),2*a*(Math.random()-.5))},Point.prototype={exploded:function(){return isNaN(this.x)||isNaN(this.y)},add:function(a){return new Point(this.x+a.x,this.y+a.y)},subtract:function(a){return new Point(this.x-a.x,this.y-a.y)},multiply:function(a){return new Point(this.x*a,this.y*a)},divide:function(a){return new Point(this.x/a,this.y/a)},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normal:function(){return new Point(-this.y,this.x)},normalize:function(){return this.divide(this.magnitude())}};var ParticleSystem=function(a,b,c,d,e,f,g,h){var i=[],j=null,k=0,l=null,m=.04,n=[20,20,20,20],o=null,p=null;if("object"==typeof a){var q=a;c=q.friction,a=q.repulsion,e=q.fps,f=q.dt,b=q.stiffness,d=q.gravity,g=q.precision,h=q.integrator}"verlet"!=h&&"euler"!=h&&(h="verlet"),c=isNaN(c)?.5:c,a=isNaN(a)?1e3:a,e=isNaN(e)?55:e,b=isNaN(b)?600:b,f=isNaN(f)?.02:f,g=isNaN(g)?.6:g,d=d===!0;var r,s=void 0!==e?1e3/e:20,t={integrator:h,repulsion:a,stiffness:b,friction:c,dt:f,gravity:d,precision:g,timeout:s},u={renderer:null,tween:null,nodes:{},edges:{},adjacency:{},names:{},kernel:null},v={parameters:function(a){return void 0!==a&&(isNaN(a.precision)||(a.precision=Math.max(0,Math.min(1,a.precision))),$.each(t,function(b){void 0!==a[b]&&(t[b]=a[b])}),u.kernel.physicsModified(a)),t},fps:function(a){return void 0===a?u.kernel.fps():void v.parameters({timeout:1e3/(a||50)})},start:function(){u.kernel.start()},stop:function(){u.kernel.stop()},addNode:function(a,b){b=b||{};var c=u.names[a];if(c)return c.data=b,c;if(void 0!=a){var d=void 0!=b.x?b.x:null,e=void 0!=b.y?b.y:null,f=b.fixed?1:0,g=new Node(b);return g.name=a,u.names[a]=g,u.nodes[g._id]=g,i.push({t:"addNode",id:g._id,m:g.mass,x:d,y:e,f:f}),v._notify(),g}},pruneNode:function(a){var b=v.getNode(a);"undefined"!=typeof u.nodes[b._id]&&(delete u.nodes[b._id],delete u.names[b.name]),$.each(u.edges,function(a,c){(c.source._id===b._id||c.target._id===b._id)&&v.pruneEdge(c)}),i.push({t:"dropNode",id:b._id}),v._notify()},getNode:function(a){return void 0!==a._id?a:"string"==typeof a||"number"==typeof a?u.names[a]:void 0},eachNode:function(a){$.each(u.nodes,function(b,c){if(null!=c._p.x&&null!=c._p.y){var d=null!==l?v.toScreen(c._p):c._p;a.call(v,c,d)}})},addEdge:function(a,b,c){a=v.getNode(a)||v.addNode(a),b=v.getNode(b)||v.addNode(b),c=c||{};var d=new Edge(a,b,c),e=a._id,f=b._id;u.adjacency[e]=u.adjacency[e]||{},u.adjacency[e][f]=u.adjacency[e][f]||[];var g=u.adjacency[e][f].length>0;if(g)return void $.extend(u.adjacency[e][f].data,d.data);u.edges[d._id]=d,u.adjacency[e][f].push(d);var h=void 0!==d.length?d.length:1;return i.push({t:"addSpring",id:d._id,fm:e,to:f,l:h}),v._notify(),d},pruneEdge:function(a){i.push({t:"dropSpring",id:a._id}),delete u.edges[a._id];for(var b in u.adjacency)for(var c in u.adjacency[b])for(var d=u.adjacency[b][c],e=d.length-1;e>=0;e--)u.adjacency[b][c][e]._id===a._id&&u.adjacency[b][c].splice(e,1);v._notify()},getEdges:function(a,b){return a=v.getNode(a),b=v.getNode(b),a&&b?"undefined"!=typeof u.adjacency[a._id]&&"undefined"!=typeof u.adjacency[a._id][b._id]?u.adjacency[a._id][b._id]:[]:[]},getEdgesFrom:function(a){if(a=v.getNode(a),!a)return[];if("undefined"!=typeof u.adjacency[a._id]){var b=[];return $.each(u.adjacency[a._id],function(a,c){b=b.concat(c)}),b}return[]},getEdgesTo:function(a){if(a=v.getNode(a),!a)return[];var b=[];return $.each(u.edges,function(c,d){d.target==a&&b.push(d)}),b},eachEdge:function(a){$.each(u.edges,function(b,c){var d=u.nodes[c.source._id]._p,e=u.nodes[c.target._id]._p;null!=d.x&&null!=e.x&&(d=null!==l?v.toScreen(d):d,e=null!==l?v.toScreen(e):e,d&&e&&a.call(v,c,d,e))})},prune:function(a){var b={dropped:{nodes:[],edges:[]}};return void 0===a?$.each(u.nodes,function(a,c){b.dropped.nodes.push(c),v.pruneNode(c)}):v.eachNode(function(c){var d=a.call(v,c,{from:v.getEdgesFrom(c),to:v.getEdgesTo(c)});d&&(b.dropped.nodes.push(c),v.pruneNode(c))}),b},graft:function(a){var b={added:{nodes:[],edges:[]}};return a.nodes&&$.each(a.nodes,function(a,c){var d=v.getNode(a);d?d.data=c:b.added.nodes.push(v.addNode(a,c)),u.kernel.start()}),a.edges&&$.each(a.edges,function(a,c){var d=v.getNode(a);d||b.added.nodes.push(v.addNode(a,{})),$.each(c,function(c,d){var e=v.getNode(c);e||b.added.nodes.push(v.addNode(c,{}));var f=v.getEdges(a,c);f.length>0?f[0].data=d:b.added.edges.push(v.addEdge(a,c,d))})}),b},merge:function(a){var b={added:{nodes:[],edges:[]},dropped:{nodes:[],edges:[]}};$.each(u.edges,function(c,d){(void 0===a.edges[d.source.name]||void 0===a.edges[d.source.name][d.target.name])&&(v.pruneEdge(d),b.dropped.edges.push(d))});var c=v.prune(function(c){return void 0===a.nodes[c.name]?(b.dropped.nodes.push(c),!0):void 0}),d=v.graft(a);return b.added.nodes=b.added.nodes.concat(d.added.nodes),b.added.edges=b.added.edges.concat(d.added.edges),b.dropped.nodes=b.dropped.nodes.concat(c.dropped.nodes),b.dropped.edges=b.dropped.edges.concat(c.dropped.edges),b},tweenNode:function(a,b,c){var d=v.getNode(a);d&&u.tween.to(d,b,c)},tweenEdge:function(a,b,c,d){if(void 0===d)v._tweenEdge(a,b,c);else{var e=v.getEdges(a,b);$.each(e,function(a,b){v._tweenEdge(b,c,d)})}},_tweenEdge:function(a,b,c){a&&void 0!==a._id&&u.tween.to(a,b,c)},_updateGeometry:function(a){if(void 0!=a){var b=a.epoch<k;r=a.energy;var c=a.geometry;if(void 0!==c)for(var d=0,e=c.length/3;e>d;d++){var f=c[3*d];b&&void 0==u.nodes[f]||(u.nodes[f]._p.x=c[3*d+1],u.nodes[f]._p.y=c[3*d+2])}}},screen:function(a){return void 0==a?{size:l?objcopy(l):void 0,padding:n.concat(),step:m}:(void 0!==a.size&&v.screenSize(a.size.width,a.size.height),isNaN(a.step)||v.screenStep(a.step),void(void 0!==a.padding&&v.screenPadding(a.padding)))},screenSize:function(a,b){l={width:a,height:b},v._updateBounds()},screenPadding:function(a,b,c,d){trbl=$.isArray(a)?a:[a,b,c,d];var e=trbl[0],f=trbl[1],g=trbl[2];void 0===f?trbl=[e,e,e,e]:void 0==g&&(trbl=[e,f,e,f]),n=trbl},screenStep:function(a){m=a},toScreen:function(a){if(o&&l){var b=n||[0,0,0,0],c=o.bottomright.subtract(o.topleft),d=b[3]+a.subtract(o.topleft).divide(c.x).x*(l.width-(b[1]+b[3])),e=b[0]+a.subtract(o.topleft).divide(c.y).y*(l.height-(b[0]+b[2]));return arbor.Point(d,e)}},fromScreen:function(a){if(o&&l){var b=n||[0,0,0,0],c=o.bottomright.subtract(o.topleft),d=(a.x-b[3])/(l.width-(b[1]+b[3]))*c.x+o.topleft.x,e=(a.y-b[0])/(l.height-(b[0]+b[2]))*c.y+o.topleft.y;return arbor.Point(d,e)}},_updateBounds:function(a){if(null!==l){p=a?a:v.bounds();var b=new Point(p.bottomright.x,p.bottomright.y),c=new Point(p.topleft.x,p.topleft.y),d=b.subtract(c),e=c.add(d.divide(2)),f=4,g=new Point(Math.max(d.x,f),Math.max(d.y,f));if(p.topleft=e.subtract(g.divide(2)),p.bottomright=e.add(g.divide(2)),!o)return $.isEmptyObject(u.nodes)?!1:(o=p,!0);var h=m;_newBounds={bottomright:o.bottomright.add(p.bottomright.subtract(o.bottomright).multiply(h)),topleft:o.topleft.add(p.topleft.subtract(o.topleft).multiply(h))};var i=new Point(o.topleft.subtract(_newBounds.topleft).magnitude(),o.bottomright.subtract(_newBounds.bottomright).magnitude());return i.x*l.width>1||i.y*l.height>1?(o=_newBounds,!0):!1}},energy:function(){return r},bounds:function(){var a=null,b=null;return $.each(u.nodes,function(c,d){if(!a)return a=new Point(d._p),void(b=new Point(d._p));var e=d._p;null!==e.x&&null!==e.y&&(e.x>a.x&&(a.x=e.x),e.y>a.y&&(a.y=e.y),e.x<b.x&&(b.x=e.x),e.y<b.y&&(b.y=e.y))}),a&&b?{bottomright:a,topleft:b}:{topleft:new Point(-1,-1),bottomright:new Point(1,1)}},nearest:function(a){null!==l&&(a=v.fromScreen(a));var b={node:null,point:null,distance:null};return $.each(u.nodes,function(c,d){var e=d._p;if(null!==e.x&&null!==e.y){var f=e.subtract(a).magnitude();(null===b.distance||f<b.distance)&&(b={node:d,point:e,distance:f},null!==l&&(b.screenPoint=v.toScreen(e)))}}),b.node?(null!==l&&(b.distance=v.toScreen(b.node.p).subtract(v.toScreen(a)).magnitude()),b):null},_notify:function(){null===j?k++:clearTimeout(j),j=setTimeout(v._synchronize,20)},_synchronize:function(){i.length>0&&(u.kernel.graphChanged(i),i=[],j=null)}};return u.kernel=Kernel(v),u.tween=u.kernel.tween||null,Node.prototype.__defineGetter__("p",function(){var a=this,b={};return b.__defineGetter__("x",function(){return a._p.x}),b.__defineSetter__("x",function(b){u.kernel.particleModified(a._id,{x:b})}),b.__defineGetter__("y",function(){return a._p.y}),b.__defineSetter__("y",function(b){u.kernel.particleModified(a._id,{y:b})}),b.__proto__=Point.prototype,b}),Node.prototype.__defineSetter__("p",function(a){this._p.x=a.x,this._p.y=a.y,u.kernel.particleModified(this._id,{x:a.x,y:a.y})}),Node.prototype.__defineGetter__("mass",function(){return this._mass}),Node.prototype.__defineSetter__("mass",function(a){this._mass=a,u.kernel.particleModified(this._id,{m:a})}),Node.prototype.__defineSetter__("tempMass",function(a){u.kernel.particleModified(this._id,{_m:a})}),Node.prototype.__defineGetter__("fixed",function(){return this._fixed}),Node.prototype.__defineSetter__("fixed",function(a){this._fixed=a,u.kernel.particleModified(this._id,{f:a?1:0})}),v},BarnesHutTree=function(){var a=[],b=0,c=null,d=.5,e={init:function(a,f,g){d=g,b=0,c=e._newBranch(),c.origin=a,c.size=f.subtract(a)},insert:function(a){for(var b=c,d=[a];d.length;){var f=d.shift(),g=f._m||f.m,h=e._whichQuad(f,b);if(void 0===b[h])b[h]=f,b.mass+=g,b.p=b.p?b.p.add(f.p.multiply(g)):f.p.multiply(g);else if("origin"in b[h])b.mass+=g,b.p=b.p?b.p.add(f.p.multiply(g)):f.p.multiply(g),b=b[h],d.unshift(f);else{var i=b.size.divide(2),j=new Point(b.origin);"s"==h[0]&&(j.y+=i.y),"e"==h[1]&&(j.x+=i.x);var k=b[h];if(b[h]=e._newBranch(),b[h].origin=j,b[h].size=i,b.mass=g,b.p=f.p.multiply(g),b=b[h],k.p.x===f.p.x&&k.p.y===f.p.y){var l=.08*i.x,m=.08*i.y;k.p.x=Math.min(j.x+i.x,Math.max(j.x,k.p.x-l/2+Math.random()*l)),k.p.y=Math.min(j.y+i.y,Math.max(j.y,k.p.y-m/2+Math.random()*m))}d.push(k),d.unshift(f)}}},applyForces:function(a,b){for(var e=[c];e.length;)if(node=e.shift(),void 0!==node&&a!==node)if("f"in node){var f=a.p.subtract(node.p),g=Math.max(1,f.magnitude()),h=(f.magnitude()>0?f:Point.random(1)).normalize();a.applyForce(h.multiply(b*(node._m||node.m)).divide(g*g))}else{var i=a.p.subtract(node.p.divide(node.mass)).magnitude(),j=Math.sqrt(node.size.x*node.size.y);if(j/i>d)e.push(node.ne),e.push(node.nw),e.push(node.se),e.push(node.sw);else{var f=a.p.subtract(node.p.divide(node.mass)),g=Math.max(1,f.magnitude()),h=(f.magnitude()>0?f:Point.random(1)).normalize();a.applyForce(h.multiply(b*node.mass).divide(g*g))}}},_whichQuad:function(a,b){if(a.p.exploded())return null;var c=a.p.subtract(b.origin),d=b.size.divide(2);return c.y<d.y?c.x<d.x?"nw":"ne":c.x<d.x?"sw":"se"},_newBranch:function(){if(a[b]){var c=a[b];c.ne=c.nw=c.se=c.sw=void 0,c.mass=0,delete c.p}else c={origin:null,size:null,nw:void 0,ne:void 0,sw:void 0,se:void 0,mass:0},a[b]=c;return b++,c}};return e},Physics=function(a,b,c,d,e,f){var g=BarnesHutTree(),h={particles:{},springs:{}},i={particles:{}},j=[],k=[],l=0,m={sum:0,max:0,mean:0},n={topleft:new Point(-1,-1),bottomright:new Point(1,1)},o=1e3,p={integrator:["verlet","euler"].indexOf(f)>=0?f:"verlet",stiffness:void 0!==b?b:1e3,repulsion:void 0!==c?c:600,friction:void 0!==d?d:.3,gravity:!1,dt:void 0!==a?a:.02,theta:.4,init:function(){return p},modifyPhysics:function(a){$.each(["stiffness","repulsion","friction","gravity","dt","precision","integrator"],function(b,c){if(void 0!==a[c]){if("precision"==c)return void(p.theta=1-a[c]);if(p[c]=a[c],"stiffness"==c){var d=a[c];$.each(h.springs,function(a,b){b.k=d})}}})},addNode:function(a){var b=a.id,c=a.m,d=n.bottomright.x-n.topleft.x,e=n.bottomright.y-n.topleft.y,f=new Point(null!=a.x?a.x:n.topleft.x+d*Math.random(),null!=a.y?a.y:n.topleft.y+e*Math.random());h.particles[b]=new Particle(f,c),h.particles[b].connections=0,h.particles[b].fixed=1===a.f,i.particles[b]=h.particles[b],j.push(h.particles[b])},dropNode:function(a){var b=a.id,c=h.particles[b],d=$.inArray(c,j);d>-1&&j.splice(d,1),delete h.particles[b],delete i.particles[b]},modifyNode:function(a,b){if(a in h.particles){var c=h.particles[a];"x"in b&&(c.p.x=b.x),"y"in b&&(c.p.y=b.y),"m"in b&&(c.m=b.m),"f"in b&&(c.fixed=1===b.f),"_m"in b&&(void 0===c._m&&(c._m=c.m),c.m=b._m)}},addSpring:function(a){var b=a.id,c=a.l,d=h.particles[a.fm],e=h.particles[a.to];void 0!==d&&void 0!==e&&(h.springs[b]=new Spring(d,e,c,p.stiffness),k.push(h.springs[b]),d.connections++,e.connections++,delete i.particles[a.fm],delete i.particles[a.to])},dropSpring:function(a){var b=a.id,c=h.springs[b];c.point1.connections--,c.point2.connections--;var d=$.inArray(c,k);d>-1&&k.splice(d,1),delete h.springs[b]},_update:function(a){return l++,$.each(a,function(a,b){b.t in p&&p[b.t](b)}),l},tick:function(){p.tendParticles(),"euler"==p.integrator?(p.updateForces(),p.updateVelocity(p.dt),p.updatePosition(p.dt)):(p.updateForces(),p.cacheForces(),p.updatePosition(p.dt),p.updateForces(),p.updateVelocity(p.dt)),p.tock()},tock:function(){var a=[];$.each(h.particles,function(b,c){a.push(b),a.push(c.p.x),a.push(c.p.y)}),e&&e({geometry:a,epoch:l,energy:m,bounds:n})},tendParticles:function(){$.each(h.particles,function(a,b){void 0!==b._m&&(Math.abs(b.m-b._m)<1?(b.m=b._m,delete b._m):b.m*=.98),b.v.x=b.v.y=0})},updateForces:function(){p.repulsion>0&&(p.theta>0?p.applyBarnesHutRepulsion():p.applyBruteForceRepulsion()),p.stiffness>0&&p.applySprings(),p.applyCenterDrift(),p.gravity&&p.applyCenterGravity()},cacheForces:function(){$.each(h.particles,function(a,b){b._F=b.f})},applyBruteForceRepulsion:function(){$.each(h.particles,function(a,b){$.each(h.particles,function(a,c){if(b!==c){var d=b.p.subtract(c.p),e=Math.max(1,d.magnitude()),f=(d.magnitude()>0?d:Point.random(1)).normalize();b.applyForce(f.multiply(p.repulsion*(c._m||c.m)*.5).divide(e*e*.5)),c.applyForce(f.multiply(p.repulsion*(b._m||b.m)*.5).divide(e*e*-.5))}})})},applyBarnesHutRepulsion:function(){if(n.topleft&&n.bottomright){var a=new Point(n.bottomright),b=new Point(n.topleft);g.init(b,a,p.theta),$.each(h.particles,function(a,b){g.insert(b)}),$.each(h.particles,function(a,b){g.applyForces(b,p.repulsion)})}},applySprings:function(){$.each(h.springs,function(a,b){var c=b.point2.p.subtract(b.point1.p),d=b.length-c.magnitude(),e=(c.magnitude()>0?c:Point.random(1)).normalize();b.point1.applyForce(e.multiply(b.k*d*-.5)),b.point2.applyForce(e.multiply(b.k*d*.5))})},applyCenterDrift:function(){var a=0,b=new Point(0,0);if($.each(h.particles,function(c,d){b.add(d.p),a++}),0!=a){var c=b.divide(-a);$.each(h.particles,function(a,b){b.applyForce(c)})}},applyCenterGravity:function(){$.each(h.particles,function(a,b){var c=b.p.multiply(-1);b.applyForce(c.multiply(p.repulsion/100))})},updateVelocity:function(a){var b=0,c=0,d=0;$.each(h.particles,function(e,f){if(f.fixed)return f.v=new Point(0,0),void(f.f=new Point(0,0));f.v="euler"==p.integrator?f.v.add(f.f.multiply(a)).multiply(1-p.friction):f.v.add(f.f.add(f._F.divide(f._m)).multiply(.5*a)).multiply(1-p.friction),f.f.x=f.f.y=0;var g=f.v.magnitude();g>o&&(f.v=f.v.divide(g*g));var g=f.v.magnitude(),h=g*g;b+=h,c=Math.max(h,c),d++}),m={sum:b,max:c,mean:b/d,n:d}},updatePosition:function(a){var b=null,c=null;$.each(h.particles,function(d,e){if("euler"==p.integrator)e.p=e.p.add(e.v.multiply(a));else{var f=e.f.multiply(.5*a*a).divide(e.m);e.p=e.p.add(e.v.multiply(a)).add(f)}if(!b)return b=new Point(e.p.x,e.p.y),void(c=new Point(e.p.x,e.p.y));var g=e.p;null!==g.x&&null!==g.y&&(g.x>b.x&&(b.x=g.x),g.y>b.y&&(b.y=g.y),g.x<c.x&&(c.x=g.x),g.y<c.y&&(c.y=g.y))}),n={topleft:c||new Point(-1,-1),bottomright:b||new Point(1,1)}},systemEnergy:function(){return m}};return p.init()},_nearParticle=function(a,b){var b=b||0,c=a.x,d=a.y,e=2*b;return new Point(c-b+Math.random()*e,d-b+Math.random()*e)};return"undefined"==typeof window?function(){$={each:function(a,b){if($.isArray(a))for(var c=0,d=a.length;d>c;c++)b(c,a[c]);else for(var e in a)b(e,a[e])},map:function(a,b){var c=[];return $.each(a,function(a,d){var e=b(d);void 0!==e&&c.push(e)}),c},extend:function(a,b){if("object"!=typeof b)return a;for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},isArray:function(a){return a?-1!=a.constructor.toString().indexOf("Array"):!1},inArray:function(a,b){for(var c=0,d=b.length;d>c;c++)if(b[c]===a)return c;return-1},isEmptyObject:function(a){if("object"!=typeof a)return!1;var b=!0;return $.each(a,function(){b=!1}),b}};var a=function(){var a=20,b=null,c=null,d=null,e=((new Date).valueOf(),{init:function(a){return e.timeout(a.timeout),b=Physics(a.dt,a.stiffness,a.repulsion,a.friction,e.tock),e},timeout:function(b){b!=a&&(a=b,null!==c&&(e.stop(),e.go()))},go:function(){null===c&&(d=null,c=setInterval(e.tick,a))},stop:function(){null!==c&&(clearInterval(c),c=null)},tick:function(){b.tick();var a=b.systemEnergy();(a.mean+a.max)/2<.05?(null===d&&(d=(new Date).valueOf()),(new Date).valueOf()-d>1e3&&e.stop()):d=null},tock:function(a){a.type="geometry",postMessage(a)},modifyNode:function(a,c){b.modifyNode(a,c),e.go()},modifyPhysics:function(a){b.modifyPhysics(a)},update:function(a){b._update(a)}});return e},b=a();onmessage=function(a){if(!a.data.type)return void postMessage("¿kérnèl?");if("physics"==a.data.type){var c=a.data.physics;return void b.init(a.data.physics)}switch(a.data.type){case"modify":b.modifyNode(a.data.id,a.data.mods);break;case"changes":b.update(a.data.changes),b.go();break;case"start":b.go();break;case"stop":b.stop();break;case"sys":var c=a.data.param||{};isNaN(c.timeout)||b.timeout(c.timeout),b.modifyPhysics(c),b.go()}}}():(arbor="undefined"!=typeof arbor?arbor:{},void $.extend(arbor,{ParticleSystem:ParticleSystem,Point:function(a,b){return new Point(a,b)},etc:{trace:trace,dirname:dirname,basename:basename,ordinalize:ordinalize,objcopy:objcopy,objcmp:objcmp,objkeys:objkeys,objmerge:objmerge,uniq:uniq,arbor_path:arbor_path}}))}(this.jQuery);